<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Abertura de Sinistro - Sinistros GB</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <!-- Favicon -->
  <link rel="icon" href="https://github.com/sinistrosgb-spec/sinistros-gb/blob/main/Meraki.ico?raw=true" type="image/x-icon">

  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #f0f0f0; color: #333; margin: 0; padding: 20px; }
    .container { max-width: 900px; margin: 40px auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 6px 20px rgba(0,0,0,0.1); border-top: 5px solid #003366; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .header img { height: 60px; }
    .title-container { display: flex; align-items: center; gap: 10px; justify-content: center; }
    .title-container img { height: 32px; }
    h1 { color: #003366; margin: 0; }
    .form-group { margin-bottom: 18px; }
    label { display: block; margin-bottom: 6px; font-weight: 600; color: #003366; }
    input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; }
    .checkbox-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; max-height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 15px; border-radius: 6px; background: #f9f9f9; }
    .checkbox-grid label { display: flex; align-items: center; gap: 8px; cursor: pointer; }
    button { background: #003366; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; margin-right: 10px; }
    button:hover { background: #002244; }
    .alert { padding: 12px; margin: 15px 0; border-radius: 6px; display: none; }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    .footer-credit { text-align: center; margin-top: 30px; font-size: 12px; color: #aaa; border-top: 1px solid #ddd; padding-top: 10px; }
    .login-screen { text-align: center; padding: 40px; }
    .login-form { max-width: 400px; margin: 0 auto; background: #f9f9f9; padding: 20px; border-radius: 8px; }
    .login-form input { margin-bottom: 10px; }
  </style>
</head>
<body>
  <div id="loginScreen" class="login-screen">
    <div class="header">
      <img src="https://github.com/sinistrosgb-spec/sinistros-gb/blob/main/logo-claro.png?raw=true" alt="Claro" style="height:60px;">
      <img src="https://github.com/sinistrosgb-spec/sinistros-gb/blob/main/logo-boticario.png?raw=true" alt="Botic√°rio" style="height:40px;">
    </div>
    <h2>üîê Acesso ao Sistema de Sinistros</h2>
    <div class="login-form">
      <input type="email" id="email" placeholder="Seu e-mail corporativo" style="width:100%; padding:10px; margin-bottom:10px;">
      <input type="password" id="password" placeholder="Sua senha" style="width:100%; padding:10px; margin-bottom:10px;">
      <button onclick="login()">Entrar</button> <br>
      <a href="#" onclick="esqueciSenha(); return false;" style="font-size:12px; color:#003366;">Esqueci a senha</a>
    </div>
    <p style="font-size:12px; color:#888; margin-top:20px;">Apenas usu√°rios autorizados</p>
  </div>

  <div id="mainForm" style="display:none;">
    <div class="container">
      <div class="header">
        <img src="https://github.com/sinistrosgb-spec/sinistros-gb/blob/main/logo-claro.png?raw=true" alt="Claro" style="height:60px;">
        <div class="title-container">
          <img src="https://github.com/sinistrosgb-spec/sinistros-gb/blob/main/Meraki.ico?raw=true" alt="√çcone Meraki">
          <h1>üìù Abertura de Sinistro</h1>
        </div>
        <img src="https://github.com/sinistrosgb-spec/sinistros-gb/blob/main/logo-boticario.png?raw=true" alt="Grupo Botic√°rio" style="height:40px;">
      </div>

      <div id="status" class="alert"></div>

      <form id="sinistroForm">
        <div class="form-group">
          <label>Refer√™ncia *</label>
          <select id="registro" required>
            <option value="">Selecione...</option>
            <option value="TT Siebel">TT Siebel</option>
            <option value="OS BOTI">OS BOTI</option>
            <option value="INC">INC</option>
          </select>
        </div>

        <div class="form-group">
          <label>N√∫mero da Refer√™ncia *</label>
          <input type="text" id="numero_ocorrencia" required>
        </div>

        <div class="form-group">
          <label>Franquia *</label>
          <input type="text" id="franquia" required>
        </div>

        <div class="form-group">
          <label>Respons√°vel pela Franquia *</label>
          <input type="text" id="responsavel_franquia" required>
        </div>

        <div class="form-group">
          <label>Telefone do Respons√°vel</label>
          <input type="text" id="telefone_responsavel">
        </div>

        <div class="form-group">
          <label>E-mail do Respons√°vel *</label>
          <input type="email" id="email_responsavel" required>
        </div>

        <div class="form-group">
          <label>Data do Sinistro *</label>
          <input type="datetime-local" id="data_sinistro" required>
        </div>

        <div class="form-group">
          <label>Equipamentos Selecionados *</label>
          <div class="checkbox-grid" id="equipamentos-grid"></div>
          <input type="hidden" id="equipamentos_selecionados" required>
        </div>

        <div class="form-group">
          <label>Modelos dos Equipamentos *</label>
          <div class="checkbox-grid" id="modelos-grid"></div>
          <input type="hidden" id="modelos_equipamentos" required>
        </div>

        <div class="form-group">
          <label>Descri√ß√£o do Sinistro *</label>
          <textarea id="descricao" rows="4" required></textarea>
        </div>

        <div class="form-group">
          <label>Anexos (fotos, v√≠deos, PDFs)</label>
          <input type="file" id="anexos" multiple accept="image/*,video/*,application/pdf">
        </div>

        <button type="submit">üì§ Registrar Sinistro</button>
        <button type="button" onclick="logout()">Sair</button>
      </form>

      <div class="footer-credit">
        Desenvolvido por F√°bio Matos | Sistema Sinistros GB
      </div>
    </div>
  </div>

  <script>
    // üî• Supabase
    const supabaseUrl = 'https://zszgjhxyebhguyxguvek.supabase.co';
    const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpzemdqaHh5ZWJoZ3V5eGd1dmVrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2Mjg4NDYsImV4cCI6MjA3MTIwNDg0Nn0.ac8jt3XRlhpNnwt4eJKwMN85K9IrG2i8y3EzRaEf1c8';
    const supabase = supabase.createClient(supabaseUrl, supabaseAnonKey);

    // Fun√ß√£o de recupera√ß√£o de senha
    async function esqueciSenha() {
      const email = prompt('Digite seu e-mail para redefinir a senha:');
      if (!email) return;

      const { error } = await supabase.auth.resetPasswordForEmail(email, {
        redirectTo: 'https://sinistrosgb-spec.github.io/sinistros-gb/'
      });

      if (error) {
        alert('Erro: ' + error.message);
      } else {
        alert('‚úÖ Enviamos um link de redefini√ß√£o para ' + email + '.\nVerifique seu e-mail.');
      }
    }

    // Verifica sess√£o ao carregar
    window.addEventListener('load', async () => {
      try {
        const { data: { session }, error } = await supabase.auth.getSession();
        if (error) console.error('Erro ao verificar sess√£o:', error);
        if (session) {
          showForm();
        } else {
          showLogin();
        }
      } catch (err) {
        console.error('Erro no loginScreen:', err);
        showLogin();
      }
    });

    // Fun√ß√£o de login
    async function login() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      const { error } = await supabase.auth.signInWithPassword({ email, password });

      if (error) {
        alert('Erro de login: ' + error.message);
      } else {
        showForm();
      }
    }

    function logout() {
      supabase.auth.signOut();
      showLogin();
    }

    function showLogin() {
      document.getElementById('loginScreen').style.display = 'block';
      document.getElementById('mainForm').style.display = 'none';
    }

    function showForm() {
      document.getElementById('loginScreen').style.display = 'none';
      document.getElementById('mainForm').style.display = 'block';
      // Aqui voc√™ pode recriar os checkboxes se necess√°rio
    }
  </script>
</body>
</html>
